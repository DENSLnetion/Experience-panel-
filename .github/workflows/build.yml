name: One Shade Forensic Build

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  forensic_build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    # 1. BUKTIIN STRUKTUR FOLDER LU BENER
    # Ini bakal nge-list semua file di log. Kalau salah taruh, ketauan disini.
    - name: ðŸ“‚ CEK FILE (WAJIB LIAT LOG INI)
      run: |
        echo "=== ROOT DIRECTORY ==="
        ls -la
        echo "=== APP DIRECTORY ==="
        ls -la app/
        echo "=== SRC STRUCTURE ==="
        find app/src -maxdepth 4
        echo "====================="

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Setup Android SDK
      uses: android-actions/setup-android@v3

    # 2. PAKSA GENERATE GRADLE WRAPPER
    # Karena lu ga punya gradlew di HP, kita bikin dulu
    - name: Generate Gradle Wrapper
      run: gradle wrapper --gradle-version 8.2

    - name: Make Gradlew Executable
      run: chmod +x gradlew

    # 3. BUILD DENGAN LOG MAXIMUM (INFO & STACKTRACE)
    # --info: Kasih tau detail step by step
    # --stacktrace: Kalau error, kasih tau baris berapa
    - name: Build Debug APK (Verbose)
      run: ./gradlew assembleDebug --no-daemon --stacktrace --info

    - name: Upload APK
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: OneShade-Debug
        path: app/build/outputs/apk/debug/app-debug.apk
